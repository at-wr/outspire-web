---
import MainLayout from '../../layouts/MainLayout.astro';
import { handleUniversalLink, getPathDescription } from '../../lib/deeplink';

// Tell Astro to render this page on the server (not at build time)
export const prerender = false;

// Get the path from URL parameters
const { path } = Astro.params;
const fullPath = path || '';
const pathDescription = getPathDescription(fullPath);
---

<MainLayout title={pathDescription}>
  <section class="container mx-auto max-w-7xl px-4 py-12 md:py-24">
    <div class="mx-auto max-w-md space-y-6 text-center">
      <div class="space-y-2">
        <h1 class="text-2xl font-bold tracking-tight sm:text-3xl">Opening Outspire</h1>
        <p class="text-slate-600">
          Redirecting you to <span class="font-medium">{pathDescription}</span>
        </p>
      </div>

      <div class="flex justify-center">
        <div class="relative h-12 w-12">
          <div class="absolute h-12 w-12 rounded-full border-4 border-slate-200"></div>
          <div class="absolute h-12 w-12 animate-spin rounded-full border-4 border-transparent border-t-slate-900"></div>
        </div>
      </div>
      
      <div class="rounded-lg border border-slate-200 bg-slate-50 p-4 text-sm text-slate-700">
        <p>If nothing happens, you may not have Outspire installed.</p>
        <p class="mt-2">
          <a 
            href="https://apps.apple.com/app/outspire/id0000000000" 
            class="text-slate-900 font-medium underline underline-offset-4 hover:text-slate-700"
          >
            Download Outspire on the App Store
          </a>
        </p>
      </div>
    </div>
  </section>
</MainLayout>

<script define:vars={{ path: fullPath }}>
  // Try to launch the app when page loads
  document.addEventListener('DOMContentLoaded', () => {
    // Import the utility functions
    import('../../lib/deeplink.ts').then(({ handleUniversalLink }) => {
      handleUniversalLink(path);
    });
  });
</script>
